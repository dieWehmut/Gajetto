# 文件批量重命名工具

一个简洁的 Windows 右键菜单扩展工具,支持批量重命名文件和恢复重命名操作。

## ⚠️ 重要提示

> **使用前必读:**
> - ⚡ 目前问题非常多,建议不要频繁使用,仅在必要时批量修改
> - 🚫 暂不支持文件夹批量重命名
> - ⚠️ 批量恢复功能不稳定,谨慎使用
> - 🔄 请勿与 Windows 自带重命名功能混用(Ctrl+Z 记录可能冲突)

### Windows 文件系统大小写限制 (重要)

> 注意: 以下行为是 Windows 系统级别的限制,不是本工具的 bug。

- Windows 的常见文件系统 (NTFS / FAT32) 默认**不区分大小写**。这意味着在同一文件夹中，`a.txt` 与 `A.txt` 被视为同一个文件，不能同时存在两个仅大小写不同的文件名。

示例说明：

1. 将 `a.txt` 重命名为 `A.txt` —— 这通常是允许的（仅修改显示大小写）。
2. 但如果此时另一个文件 `b.txt` 想要改名为 `a.txt`，系统会认为 `a.txt` 已存在（因为 `A.txt` 与 `a.txt` 在 Windows 下等价），因此会被阻止或被视为冲突。

如果你确实需要同时保留大小写不同的文件，请使用区分大小写的文件系统（例如 Linux 上的 ext4，或启用了大小写敏感选项的虚拟环境）。

### Windows 自带重命名功能说明

**提示:** 以防有人不知道，Windows 自带的批量重命名也很实用:

1. 选中多个文件
2. 按 `F2` 或右键选择"重命名"
3. 输入新名称后按回车

**效果:**
- **文件夹:** 自动变成 `x`、`x (2)`、`x (3)`...
- **文件:** 自动变成 `x (1)`、`x (2)`、`x (3)`...

**本工具优势:** 支持为每个文件设置不同的名称(而非统一名称+序号)

## 🎯 功能特性

### ✨ 批量重命名 (BatchRename)

- 右键选择一个或多个文件
- 逐个弹出重命名窗口
- 支持修改文件名和扩展名
- 简洁的 GUI 界面,无命令行窗口
- 自动保存重命名历史

### 🔄 恢复重命名 (RestoreRename)

- 一键恢复到上一个文件名
- 支持恢复扩展名
- 基于历史记录自动还原

## 📋 安装要求

- Windows 7/8/10/11
- Python 3.6 或更高版本
- 管理员权限(仅安装时需要)

## � 部署位置

**本工具可放置在任意位置!**

- ✅ 可以放在 `C:\Tools\renameFiles\`
- ✅ 可以放在 `D:\MyTools\`
- ✅ 可以放在桌面或任何你喜欢的文件夹
- ⚠️ 唯一要求:**保持所有文件在同一个文件夹内**

**说明:**

- 安装程序会自动检测工具所在位置
- 历史记录文件会保存在工具所在文件夹
- 移动文件夹后需要重新运行 `install.bat`

## �🚀 安装步骤

### 1. 检查 Python 环境

打开命令提示符(cmd),输入:

```cmd
python --version
```

如果显示 Python 版本号(如 `Python 3.x.x`),则已安装 Python。

如果提示未找到命令,请访问 [Python 官网](https://www.python.org/downloads/) 下载安装 Python。

### 2. 安装工具

1. 双击 `install.bat`
2. 在 UAC 提示框中点击 **"是"** 授予管理员权限
3. 等待安装完成(窗口会在 3 秒后自动关闭)

安装程序会自动:

- 检查 Python 环境
- 创建菜单图标
- 注册右键菜单

**注意:** 右键菜单可能需要重启资源管理器或重新打开文件夹才能显示。

## 📖 使用方法

### 批量重命名

1. 在文件资源管理器中选择一个或多个文件
2. 右键点击,选择 **"批量重命名"**
3. 在弹出的窗口中输入新文件名
4. 点击 **"确定"** 完成重命名,或点击 **"跳过"** 跳过当前文件
5. 重复步骤 3-4,直到所有文件处理完毕

**快捷键:**

- `Enter` - 确定重命名
- `Esc` - 跳过当前文件

**注意事项:**

- 可以修改文件名和扩展名
- 如果新文件名已存在,会提示是否覆盖
- 所有重命名操作会自动记录到历史中

### 恢复重命名

1. 选择之前重命名过的文件
2. 右键点击,选择 **"恢复重命名"**
3. 文件会自动恢复到上一个名称

**注意事项:**

- 只能恢复通过本工具重命名的文件
- 支持恢复大小写修改(如 `file.txt` ← `File.txt`)
- 如果旧文件名已被其他文件占用,会自动重命名为 `文件名(1).扩展名`

**智能冲突处理:**

- 系统自动检测文件名冲突
- 自动添加编号: `文件.txt` → `文件(1).txt` → `文件(2).txt`
- 无需手动处理冲突,一键恢复

## 🗑️ 卸载方法

1. 双击 `uninstall.bat`
2. 在 UAC 提示框中点击 **"是"** 授予管理员权限
3. 等待卸载完成(窗口会在 3 秒后自动关闭)

卸载程序会:

- 删除右键菜单注册表项

**注意:** 如果菜单项仍然显示,请重启资源管理器或重新打开文件夹。

**注意:** 卸载不会删除文件

## 📁 文件说明

```plaintext
renameFiles\                    (可放在任意位置)
│
├── rename_tool.py              # 主程序脚本
├── create_icons.py             # 图标生成脚本
├── install.bat                 # 安装脚本(双击运行,自动请求管理员权限)
├── uninstall.bat               # 卸载脚本(双击运行,自动请求管理员权限)
├── batch_rename.ico            # 批量重命名图标(安装时自动生成)
├── restore_rename.ico          # 恢复重命名图标(安装时自动生成)
├── rename_history.json         # 重命名历史记录(使用后自动生成)
└── README.md                   # 说明文档(本文件)
```

## ❓ 常见问题

### Q1: 安装时提示"需要管理员权限"或 UAC 弹窗

**A:** 这是正常的,直接双击 `install.bat` 即可,系统会自动弹出 UAC 提示框请求管理员权限,点击"是"即可继续安装。

### Q2: 安装时提示"未检测到 Python 环境"

**A:** 请先安装 Python 3.x,下载地址: [Python 官网](https://www.python.org/downloads/)

安装时勾选 "Add Python to PATH" 选项。

### Q3: 右键菜单没有图标或图标显示异常

**A:** 这可能是因为:

1. PIL 库未正确安装 - 运行 `pip install Pillow`
2. 图标文件损坏 - 重新运行 `python create_icons.py`
3. 需要重启资源管理器 - 运行 `taskkill /f /im explorer.exe && start explorer.exe`

### Q4: 点击菜单后没有反应

**A:** 检查以下几点:

1. Python 是否正确安装
2. 查看是否有错误提示窗口被其他窗口遮挡

### Q5: 如何查看重命名历史

**A:** 历史记录保存在 `rename_history.json` 文件中,可以用文本编辑器打开查看。

### Q6: 能否同时重命名文件夹?

**A:** 当前版本仅支持文件重命名,不支持文件夹。

### Q7: 恢复重命名后,历史记录会保留吗?

**A:** 不会,恢复成功后会从历史记录中删除该条记录(注: 有多条修改历史记录的同一个文件可能未删除干净)

### Q8: 如果我移动了整个工具文件夹怎么办?

**A:** 移动文件夹后,需要重新安装:

1. 在新位置以管理员身份运行 `install.bat`
2. 工具会自动适配新位置并更新注册表
3. 历史记录文件 `rename_history.json` 会保留在文件夹中

**提示:** 不需要先卸载,直接重新安装即可覆盖旧的注册表项。

### Q9: 安装/卸载后右键菜单没有更新怎么办?

**A:** 右键菜单可能需要手动刷新才能显示变化:

**方法 1: 重启资源管理器**

1. 按 `Ctrl + Shift + Esc` 打开任务管理器
2. 找到 "Windows 资源管理器" 或 "explorer.exe"
3. 右键选择 "重新启动"

**方法 2: 使用命令**

在命令提示符(管理员)中运行:

```cmd
taskkill /f /im explorer.exe && start explorer.exe
```

**方法 3: 重新打开文件夹**

- 简单关闭当前文件夹窗口,重新打开即可

## 🔧 技术细节

### 实现原理

1. **右键菜单注册**: 通过修改 Windows 注册表 `HKEY_CLASSES_ROOT\*\shell\` 添加菜单项
2. **Python GUI**: 使用 `tkinter` 创建重命名窗口
3. **历史记录**: 使用 JSON 格式保存在 `rename_history.json` 文件中
4. **图标生成**: 使用 `PIL/Pillow` 库动态生成 ICO 图标

### 注册表路径

```registry
HKEY_CLASSES_ROOT\*\shell\BatchRename
HKEY_CLASSES_ROOT\*\shell\RestoreRename
```

### 历史记录格式

```json
{
  "C:\\path\\to\\new_file.txt": {
    "old_path": "C:\\path\\to\\old_file.txt",
    "old_name": "old_file.txt",
    "timestamp": "2025-10-26T12:00:00"
  }
}
```

## 📝 更新日志

### v1.0.0 (2025-10-26)

- ✅ 初始版本发布
- ✅ 支持批量重命名功能
- ✅ 支持恢复重命名功能
- ✅ 添加彩色图标
- ✅ 简洁的 GUI 界面
- ✅ 自动保存历史记录

## 💬 联系与反馈

> **再次提醒:** 目前问题非常多,建议不要频繁使用,仅在必要时批量修改,批量恢复功能建议谨慎使用。

---

### 享受便捷的文件重命名体验! 🎉
